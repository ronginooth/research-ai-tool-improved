# 検索クエリ生成パターンの検討

## 目的
ユーザーの研究意図を深く理解し、学術データベース（Semantic Scholar、PubMed）で最も効果的な検索を行うためのキーワード生成方法を検討する。

---

## パターン1: 単一キーワード文字列（現在の方式）

### アプローチ
- スペース区切りのキーワードを生成
- 検索エンジンが自動的にAND検索として解釈

### プロンプト例
```
以下の研究クエリを英語の学術検索用キーワードに変換してください。
- すべての重要なキーワードを含める
- 関連する専門用語も追加する
- 12-15語程度で出力

クエリ: "キネシンの繊毛への影響"
英語キーワード: kinesin motor protein cilia ciliary function regulation
```

### 生成例
```
"kinesin motor protein cilia ciliary function regulation mechanism"
```

### メリット
- シンプルで実装が容易
- すべての検索エンジンで動作
- 検索結果が広範囲に及ぶ

### デメリット
- AND検索のみで、OR検索ができない
- 関連性の低い結果も含まれる可能性
- 検索の精度を細かく制御できない

---

## パターン2: 明示的なAND/OR検索クエリ

### アプローチ
- AND/ORを明示的に使用した検索クエリを生成
- PubMedなど、AND/ORをサポートする検索エンジンで使用

### プロンプト例
```
以下の研究クエリを分析し、学術データベース用の検索クエリを生成してください。

【ルール】
1. 必須キーワード（AND）: クエリの核心となる重要な概念
2. 関連キーワード（OR）: 同義語や関連概念
3. PubMed形式で出力: (keyword1 OR keyword2) AND (keyword3 OR keyword4)

クエリ: "キネシンの繊毛への影響"
```

### 生成例
```
(kinesin OR "motor protein") AND (cilia OR ciliary OR "ciliary function") AND (effect OR regulation OR mechanism)
```

### メリット
- 検索の精度を細かく制御可能
- 同義語を明示的に含められる
- 必須概念と関連概念を区別できる

### デメリット
- Semantic ScholarはAND/OR構文をサポートしていない可能性
- 検索エンジンごとに異なる構文が必要
- 実装が複雑になる

---

## パターン3: 複数クエリパターンの生成と統合

### アプローチ
- 複数の検索クエリパターンを生成
- それぞれで検索し、結果を統合

### プロンプト例
```
以下の研究クエリを分析し、3つの異なる検索戦略でキーワードを生成してください：

1. 【広範囲検索】: 主要概念を含む広い検索
2. 【焦点検索】: 特定の関係性に焦点を当てた検索
3. 【詳細検索】: 具体的なメカニズムやプロセスに焦点を当てた検索

クエリ: "キネシンの繊毛への影響"
```

### 生成例
```
広範囲: kinesin cilia cell biology
焦点: kinesin motor protein ciliary function regulation
詳細: kinesin microtubule transport cilia assembly mechanism
```

### メリット
- 検索の網羅性が高い
- 異なる角度から検索できる
- 結果の多様性が確保される

### デメリット
- APIコール数が増える（3倍）
- 結果の重複除去が必要
- 処理時間が長くなる

---

## パターン4: 意図理解ベースの階層的キーワード生成

### アプローチ
- ユーザーの研究意図を深く理解
- 階層的にキーワードを生成（必須 > 重要 > 関連）

### プロンプト例
```
あなたは学術論文検索の専門家です。ユーザーの研究クエリを分析し、研究の本質的な意図を理解してください。

【分析タスク】
1. ユーザーが探している研究の種類を特定（例: メカニズム研究、機能研究、調節研究）
2. 主要な概念とその関係性を理解
3. 関連する専門用語や同義語を特定

【出力形式】
必須キーワード（必ず含める）: keyword1 keyword2
重要キーワード（優先的に含める）: keyword3 keyword4 keyword5
関連キーワード（補助的に含める）: keyword6 keyword7

クエリ: "キネシンの繊毛への影響"
```

### 生成例
```
必須: kinesin cilia
重要: motor protein ciliary function regulation
関連: microtubule transport cell biology mechanism
最終クエリ: kinesin cilia motor protein ciliary function regulation microtubule transport
```

### メリット
- ユーザーの意図を深く理解
- キーワードの優先順位が明確
- 検索の精度と網羅性のバランスが良い

### デメリット
- プロンプトが複雑
- 生成時間が長くなる可能性
- 検索エンジンごとの最適化が必要

---

## パターン5: 検索エンジン別最適化

### アプローチ
- Semantic ScholarとPubMedで異なる検索クエリを生成
- それぞれの検索エンジンの特性に最適化

### プロンプト例
```
以下の研究クエリを分析し、検索エンジン別に最適化されたキーワードを生成してください：

【Semantic Scholar用】
- スペース区切り、12-15語
- 関連概念を含める

【PubMed用】
- MeSH用語を考慮
- AND/OR構文を使用可能

クエリ: "キネシンの繊毛への影響"
```

### 生成例
```
Semantic Scholar: kinesin motor protein cilia ciliary function regulation mechanism
PubMed: (kinesin[Title/Abstract] OR "motor protein"[Title/Abstract]) AND (cilia[Title/Abstract] OR ciliary[Title/Abstract]) AND (effect[Title/Abstract] OR regulation[Title/Abstract])
```

### メリット
- 各検索エンジンの特性を最大限活用
- 検索精度が高い
- 結果の質が向上

### デメリット
- 実装が最も複雑
- メンテナンスが大変
- 検索エンジンの仕様変更に弱い

---

## 推奨アプローチ

### 推奨: パターン4（意図理解ベース）+ パターン1（単一キーワード文字列）のハイブリッド

**理由:**
1. **実装の簡潔性**: 単一キーワード文字列なので実装が簡単
2. **意図理解**: プロンプトでユーザーの意図を深く理解
3. **検索エンジン互換性**: すべての検索エンジンで動作
4. **バランス**: 精度と網羅性のバランスが良い

### 改善されたプロンプト案

```
あなたは学術論文検索の専門家です。ユーザーの研究クエリを分析し、研究の本質的な意図を理解した上で、最も効果的な検索キーワードを生成してください。

【分析ステップ】
1. ユーザーが探している研究の種類を特定（メカニズム、機能、調節、相互作用など）
2. 主要な概念とその関係性を理解
3. 関連する専門用語、同義語、関連概念を特定

【キーワード生成ルール】
- 必須概念を必ず含める（例: kinesin, cilia）
- 関連する専門用語を追加（例: motor protein, ciliary function）
- 研究の文脈に応じた概念を含める（例: regulation, mechanism, transport）
- 12-15語程度で、スペース区切りで出力
- 余計な説明や記号は不要

【例】
クエリ: "キネシンの繊毛への影響"
分析: キネシン（モータータンパク質）と繊毛（細胞小器官）の関係、機能、調節メカニズムを探している
出力: kinesin motor protein cilia ciliary function regulation mechanism microtubule transport

【クエリ】
"${query}"

【出力】
英語キーワード: 
```

---

## 検討事項

1. **APIコール数の増加**: パターン3（複数クエリ）はAPIコールが増える
2. **検索エンジンの制限**: Semantic ScholarはAND/OR構文をサポートしていない可能性
3. **ユーザー体験**: 検索時間が長くなるとユーザー体験が悪化
4. **結果の質**: より多くのキーワードが必ずしも良い結果を保証しない

---

## 実装例

### パターン1の実装例（改善版）

```typescript
const prompt = `以下の研究クエリを英語の学術検索用キーワードに変換してください。

【重要】以下のルールを必ず守ってください：
1. すべての重要なキーワードを含めてください（例: キネシン→kinesin、繊毛→cilia）
2. 日本語の専門用語は英語の専門用語に変換してください
3. 関連する専門用語や同義語も追加してください（例: kinesin → motor protein, microtubule transport）
4. 12-15語程度で出力してください（余計な記号やカンマは不要）

クエリ: "${query}"
英語キーワード:`;
```

### パターン4の実装例（推奨）

```typescript
const prompt = `あなたは学術論文検索の専門家です。ユーザーの研究クエリを分析し、研究の本質的な意図を理解した上で、最も効果的な検索キーワードを生成してください。

【分析ステップ】
1. ユーザーが探している研究の種類を特定（メカニズム、機能、調節、相互作用など）
2. 主要な概念とその関係性を理解
3. 関連する専門用語、同義語、関連概念を特定

【キーワード生成ルール】
- 必須概念を必ず含める（例: kinesin, cilia）
- 関連する専門用語を追加（例: motor protein, ciliary function）
- 研究の文脈に応じた概念を含める（例: regulation, mechanism, transport）
- 12-15語程度で、スペース区切りで出力
- 余計な説明や記号は不要

【例】
クエリ: "キネシンの繊毛への影響"
分析: キネシン（モータータンパク質）と繊毛（細胞小器官）の関係、機能、調節メカニズムを探している
出力: kinesin motor protein cilia ciliary function regulation mechanism microtubule transport

【クエリ】
"${query}"

【出力】
英語キーワード:`;
```

### パターン2の実装例（PubMed用AND/OR）

```typescript
const prompt = `以下の研究クエリを分析し、PubMed用の検索クエリを生成してください。

【ルール】
1. 必須キーワード（AND）: クエリの核心となる重要な概念
2. 関連キーワード（OR）: 同義語や関連概念
3. PubMed形式で出力: (keyword1 OR keyword2) AND (keyword3 OR keyword4)

【例】
クエリ: "キネシンの繊毛への影響"
出力: (kinesin OR "motor protein") AND (cilia OR ciliary OR "ciliary function") AND (effect OR regulation OR mechanism)

【クエリ】
"${query}"

【出力】
PubMed検索クエリ:`;
```

### パターン3の実装例（複数クエリ）

```typescript
const prompt = `以下の研究クエリを分析し、3つの異なる検索戦略でキーワードを生成してください：

1. 【広範囲検索】: 主要概念を含む広い検索（5-8語）
2. 【焦点検索】: 特定の関係性に焦点を当てた検索（8-12語）
3. 【詳細検索】: 具体的なメカニズムやプロセスに焦点を当てた検索（10-15語）

【クエリ】
"${query}"

【出力形式】
広範囲: [キーワード]
焦点: [キーワード]
詳細: [キーワード]`;

// 実装では3つのクエリをそれぞれ検索し、結果を統合
```

---

## 質問

どのパターンを採用しますか？または、複数のパターンを組み合わせますか？

1. **パターン1**: シンプルな単一キーワード文字列（現在の方式を改善）
   - メリット: 実装が簡単、すべての検索エンジンで動作
   - デメリット: 検索精度の制御が限定的

2. **パターン2**: 明示的なAND/OR検索（PubMed専用）
   - メリット: 検索精度が高い
   - デメリット: Semantic Scholarでは使用不可、実装が複雑

3. **パターン3**: 複数クエリパターン（APIコール増加）
   - メリット: 検索の網羅性が高い
   - デメリット: APIコールが3倍、処理時間が長い

4. **パターン4**: 意図理解ベース（推奨）
   - メリット: ユーザーの意図を深く理解、バランスが良い
   - デメリット: プロンプトが複雑、生成時間が長い可能性

5. **パターン5**: 検索エンジン別最適化（最も複雑）
   - メリット: 各検索エンジンの特性を最大限活用
   - デメリット: 実装が最も複雑、メンテナンスが大変

6. **ハイブリッド**: パターン4 + パターン1（推奨）
   - メリット: 意図理解 + シンプルな実装
   - デメリット: プロンプトの最適化が必要

---

最終更新: 2025-01-28 16:30:00 JST

