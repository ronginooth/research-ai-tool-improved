# Semantic Scholar APIキーが無効または期限切れになる理由

## 主な理由

### 1. **有効期限の経過**
- APIキーには有効期限が設定されている場合がある
- 期限が過ぎると自動的に無効になる
- **対処法**: 定期的に新しいAPIキーを生成する

### 2. **利用規約違反**
- 過度なリクエスト数（レート制限超過）
- 許可されていないデータの使用
- 商用利用の制限違反
- **対処法**: 利用規約を確認し、レート制限内で使用する

### 3. **アカウントの問題**
- APIキーが紐付けられているアカウントが停止された
- アカウントが削除された
- アカウントの支払い問題（有料プランの場合）
- **対処法**: Semantic Scholarのダッシュボードでアカウント状態を確認

### 4. **セキュリティ上の理由**
- APIキーが第三者に漏洩した可能性
- 不審なアクセスパターンが検出された
- **対処法**: 新しいAPIキーを生成し、古いキーを無効化

### 5. **権限設定の問題**
- APIキーに必要な権限が付与されていない
- キーの種類が間違っている（例: 読み取り専用キーで書き込み操作を試行）
- **対処法**: ダッシュボードで権限設定を確認

### 6. **無料プランの制限**
- 無料プランでは1日あたりのリクエスト数に制限がある
- 制限を超えると一時的にアクセスが拒否される
- **対処法**: 
  - レート制限を守る
  - 有料プランにアップグレード
  - リクエスト数を減らす（キャッシュの活用など）

## 現在の状況（診断結果）

### 診断結果
- **APIキー設定**: ✅ 設定済み（40文字）
- **ヘッダー設定**: ✅ 正しく設定されている
- **API動作**: ❌ 403 Forbiddenエラー

### 考えられる原因
1. **APIキーが無効または期限切れ**（最も可能性が高い）
2. **無料プランのレート制限超過**
3. **アカウントの問題**

## 対処方法

### 1. APIキーの確認と再生成
1. Semantic Scholarのダッシュボードにアクセス: https://www.semanticscholar.org/product/api
2. ログインしてアカウントを確認
3. 現在のAPIキーの状態を確認
4. 必要に応じて新しいAPIキーを生成
5. `.env.local`ファイルを更新

### 2. レート制限の確認
- 無料プラン: 通常、1日あたり100-500リクエスト程度
- 有料プラン: より高いレート制限
- 現在の使用状況をダッシュボードで確認

### 3. フォールバック処理の活用
現在の実装では、APIキーが無効でもAPIキーなしで検索が継続されます：
- 403エラーが発生した場合、自動的にAPIキーなしで再試行
- ただし、APIキーなしの場合はレート制限が厳しくなる

### 4. エラーログの確認
サーバーのログを確認して、具体的なエラーメッセージを確認：
```bash
# 開発サーバーのログを確認
# 403エラーの詳細なメッセージが表示される
```

## 推奨事項

1. **定期的なAPIキーの確認**
   - 月に1回程度、APIキーの状態を確認
   - 有効期限が近い場合は事前に更新

2. **レート制限の監視**
   - 使用状況をダッシュボードで確認
   - 必要に応じてリクエスト数を調整

3. **エラーハンドリングの改善**
   - 403エラーが発生した場合、ユーザーに通知
   - APIキーの更新を促すメッセージを表示

4. **キャッシュの活用**
   - 同じクエリの重複リクエストを避ける
   - Gemini APIのキャッシュと同様に、検索結果もキャッシュする

## 参考リンク

- Semantic Scholar API ドキュメント: https://www.semanticscholar.org/product/api
- APIキーの取得: https://www.semanticscholar.org/product/api
- 利用規約: https://www.semanticscholar.org/terms

---
最終更新: 2025-01-28 16:30:00 JST


