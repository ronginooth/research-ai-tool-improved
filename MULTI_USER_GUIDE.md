# マルチユーザー対応＆一般公開ガイド

このサイトを他の人に公開し、利用してもらうための手順です。

## 概要

このプロジェクトは、複数のユーザーがそれぞれのアカウントを作成して利用できるように設計されています。
また、あなたのAPIキー（コスト）を守るために、**「招待コード」**機能を追加しました。

## 手順

### 1. 招待コードの設定

公開する前に、`.env.local` ファイル（本番環境では環境変数）に招待コードを設定してください。

**ローカル開発環境 (.env.local):**
```bash
NEXT_PUBLIC_SIGNUP_INVITE_CODE=あなたの好きなコード（例: welcome2025）
```

**本番環境 (Vercelなど):**
Vercelのダッシュボード > Settings > Environment Variables にて同じ変数を設定してください。

### 2. ユーザーの招待方法

1.  サイトのURLを共有します。
2.  **招待コード**をユーザーに伝えます。
3.  ユーザーは、サインアップ時にそのコードを入力することでアカウントを作成できます。

### 3. APIコストについて -- 重要！

デフォルトの状態では、あなたのSupabaseプロジェクトとOpenAI/Gemini APIキーが使用されます。
招待したユーザーがサイトを使うと、**あなたのAPI料金が発生します**。

#### 各自のAPIキーを使ってもらう場合（ハイブリッドモード）
ユーザーに以下の手順を案内してください：
1.  ログイン後、右上のメニューから「設定 (/settings)」に移動する。
2.  「独自のSupabase設定」を入力してもらう（これは高度な機能です）。
    *   ※ 現状のシステムでは、OpenAI APIキーなどはサーバーサイドの共通キーが使われます。もしOpenAIキーもユーザー各自のものを使わせたい場合は、さらなる改修が必要です（今回の対応には含まれていません）。
    *   **現状:** ユーザーは自分のSupabase（データベース）を持ち込めますが、AI生成の費用はホスト（あなた）持ちです。

### 4. 具体的な公開手順 (Vercel)

`DEPLOY.md` も参照してください。

1.  GitHubにコードをPush。
2.  Vercelでプロジェクトを作成。
3.  環境変数を設定：
    *   `NEXT_PUBLIC_SUPABASE_URL`
    *   `NEXT_PUBLIC_SUPABASE_ANON_KEY`
    *   `SUPABASE_SERVICE_ROLE_KEY`
    *   `NEXT_PUBLIC_SIGNUP_INVITE_CODE` (今回追加)
    *   `OPENAI_API_KEY` (AI機能用)
    *   `GEMINI_API_KEY` (AI機能用)

## よくある質問

**Q: 招待コードを忘れた/変更したい**
A: 環境変数を変更して、再デプロイ（VercelならRedeploy）すれば新しいコードが有効になります。

**Q: 招待コードなしで登録させたい**
A: 環境変数 `NEXT_PUBLIC_SIGNUP_INVITE_CODE` を空にするか削除すれば、誰でも登録できるようになります（非推奨）。
